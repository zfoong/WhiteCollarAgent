{
  "_id": { "$oid": "68627c3ac6ce8cf75ea7548f" },
  "name": "combine text documents",
  "description": "Scans a directory for .txt, .md, and .docx files, extracts their content, and combines them into a single draft Markdown file at the specified output path.",
  "type": "atomic",
  "execution_mode": "sandboxed",
  "mode": "ALL",
  "code": "import os, sys, json, importlib, subprocess\nfrom typing import List\n\n# Ensure dependencies\n\ndef _ensure(pkg):\n    try:\n        importlib.import_module(pkg)\n    except ImportError:\n        subprocess.check_call([sys.executable, '-m', 'pip', 'install', pkg, '--quiet'])\n\n_ensure('python-docx')\n\nfrom docx import Document\n\n# ───────────────────────────────────────────────\n# Read file contents\n# ───────────────────────────────────────────────\n\ndef read_txt(path: str) -> str:\n    try:\n        with open(path, 'r', encoding='utf-8', errors='ignore') as f:\n            return f.read()\n    except Exception:\n        return ''\n\n\ndef read_md(path: str) -> str:\n    return read_txt(path)\n\n\ndef read_docx(path: str) -> str:\n    try:\n        doc = Document(path)\n        return '\\n'.join([p.text for p in doc.paragraphs])\n    except Exception:\n        return ''\n\n# ───────────────────────────────────────────────\n# Entrypoint\n# ───────────────────────────────────────────────\n\ndef _execute_action():\n    input_data = globals().get('input_data', {}) or {}\n\n    directory = input_data.get('directory_path')\n    output_path = input_data.get('output_path')\n\n    if not directory or not os.path.isdir(directory):\n        output = json.dumps({'error': \"'directory_path' must be a valid directory.\"})\n        return\n    if not output_path:\n        output = json.dumps({'error': \"'output_path' is required and must be a file path ending in .md\"})\n        return\n\n    supported_ext = {'.txt', '.md', '.docx'}\n    collected = []\n\n    for fname in os.listdir(directory):\n        ext = os.path.splitext(fname)[1].lower()\n        if ext in supported_ext:\n            collected.append(os.path.join(directory, fname))\n\n    if not collected:\n        output = json.dumps({'error': 'No supported text files found in directory.'})\n        return\n\n    content_blocks = []\n    included_files = []\n\n    for path in collected:\n        ext = os.path.splitext(path)[1].lower()\n        if ext == '.txt': text = read_txt(path)\n        elif ext == '.md': text = read_md(path)\n        elif ext == '.docx': text = read_docx(path)\n        else: continue\n\n        if text.strip():\n            content_blocks.append(f\"# File: {os.path.basename(path)}\\n\\n{text}\\n\\n---\\n\")\n            included_files.append(os.path.basename(path))\n\n    # Ensure directory for output exists\n    os.makedirs(os.path.dirname(output_path), exist_ok=True)\n\n    final_md = '\\n'.join(content_blocks)\n    with open(output_path, 'w', encoding='utf-8') as f:\n        f.write(final_md)\n\n    output = json.dumps({\n        'message': 'Draft created successfully.',\n        'output_file': output_path,\n        'files_included': included_files\n    }, ensure_ascii=False)\n\n_execute_action()",
  "input_schema": {
    "directory_path": {
      "type": "string",
      "example": "/workspace/tmp/",
      "description": "Directory containing .txt, .md, and .docx files."
    },
    "output_path": {
      "type": "string",
      "example": "/workspace/draft.md",
      "description": "Where to save the combined Markdown file."
    }
  },
  "output_schema": {
    "output_file": {
      "type": "string",
      "description": "Path to the generated draft.md file."
    },
    "files_included": {
      "type": "array",
      "description": "List of files that were included in the combined draft."
    }
  },
  "default": false,
  "scope": ["global"]
}
