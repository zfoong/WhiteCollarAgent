{
  "_id": { "$oid": "68627c3ac6ce8cf75ea7377c" },
  "name": "convert_to_pdf",
  "description": "Converts a .txt, .md, or .docx file into a PDF using Pandoc (xelatex backend) and saves it at the specified location. Validates dependencies first.",
  "type": "atomic",
  "execution_mode": "sandboxed",
  "mode": "ALL",
  "platforms": ["linux", "windows", "darwin"],
  "input_schema": {
    "input_file": {
      "type": "string",
      "example": "/path/to/input.md",
      "description": "Path to the input file (txt, md, docx)."
    },
    "output_pdf": {
      "type": "string",
      "example": "/path/to/output.pdf",
      "description": "Path where the PDF will be saved."
    }
  },
  "output_schema": {
    "status": {
      "type": "string",
      "example": "success",
      "description": "'success' if file was created, 'error' otherwise."
    },
    "pdf_file": {
      "type": "string",
      "example": "/path/to/output.pdf",
      "description": "Path to the generated PDF (on success)."
    },
    "message": {
      "type": "string",
      "example": "Missing dependency: pandoc",
      "description": "Error details (only on failure)."
    }
  },
  "code": "raise NotImplementedError('Platform overrides are required')",
  "platform_overrides": {
    "linux": {
      "code": "import os, sys, json, subprocess\n\ndef _check_dep(cmd):\n    try:\n        subprocess.check_output([cmd, '--version'], stderr=subprocess.STDOUT)\n        return True\n    except Exception:\n        return False\n\n\ndef _execute_action():\n    input_file = input_data.get('input_file')\n    output_pdf = input_data.get('output_pdf')\n\n    # Validate input file\n    if not input_file or not os.path.isfile(input_file):\n        output = (json.dumps({\"status\": \"error\", \"message\": \"Valid input_file required.\"}))\n        return\n\n    # Build default output path\n    if not output_pdf:\n        base, _ = os.path.splitext(input_file)\n        output_pdf = base + '.pdf'\n\n    # Ensure output directory\n    os.makedirs(os.path.dirname(output_pdf), exist_ok=True)\n\n    # Dependency checks\n    if not _check_dep('pandoc'):\n        output = (json.dumps({\"status\": \"error\", \"message\": \"Missing dependency: pandoc\"}))\n        return\n    if not _check_dep('xelatex'):\n        output = (json.dumps({\"status\": \"error\", \"message\": \"Missing dependency: xelatex\"}))\n        return\n\n    # Attempt conversion\n    try:\n        subprocess.check_call([\n            'pandoc', input_file, '-o', output_pdf,\n            '--pdf-engine=xelatex',\n            '--standalone'\n        ])\n        output = (json.dumps({\"status\": \"success\", \"pdf_file\": output_pdf}))\n    except Exception as e:\n        output = (json.dumps({\"status\": \"error\", \"message\": str(e)}))\n\n_execute_action()"
    },
    "windows": {
      "code": "import os, sys, json, subprocess\n\ndef _check_dep(cmd):\n    try:\n        subprocess.check_output([cmd, '--version'], stderr=subprocess.STDOUT, shell=True)\n        return True\n    except Exception:\n        return False\n\n\ndef _execute_action():\n    input_file = input_data.get('input_file')\n    output_pdf = input_data.get('output_pdf')\n\n    if not input_file or not os.path.isfile(input_file):\n        output = (json.dumps({\"status\": \"error\", \"message\": \"Valid input_file required.\"}))\n        return\n\n    if not output_pdf:\n        base, _ = os.path.splitext(input_file)\n        output_pdf = base + '.pdf'\n\n    os.makedirs(os.path.dirname(output_pdf), exist_ok=True)\n\n    if not _check_dep('pandoc'):\n        output = (json.dumps({\"status\": \"error\", \"message\": \"Missing dependency: pandoc\"}))\n        return\n    if not _check_dep('xelatex'):\n        output = (json.dumps({\"status\": \"error\", \"message\": \"Missing dependency: xelatex (MiKTeX/TeXLive)\"}))\n        return\n\n    try:\n        subprocess.check_call([\n            'pandoc', input_file, '-o', output_pdf,\n            '--pdf-engine=xelatex',\n            '--standalone'\n        ], shell=True)\n        output = (json.dumps({\"status\": \"success\", \"pdf_file\": output_pdf}))\n    except Exception as e:\n        output = (json.dumps({\"status\": \"error\", \"message\": str(e)}))\n\n_execute_action()"
    },
    "darwin": {
      "code": "import os, sys, json, subprocess\n\ndef _check_dep(cmd):\n    try:\n        subprocess.check_output([cmd, '--version'], stderr=subprocess.STDOUT)\n        return True\n    except Exception:\n        return False\n\n\ndef _execute_action():\n    input_file = input_data.get('input_file')\n    output_pdf = input_data.get('output_pdf')\n\n    if not input_file or not os.path.isfile(input_file):\n        output = (json.dumps({\"status\": \"error\", \"message\": \"Valid input_file required.\"}))\n        return\n\n    if not output_pdf:\n        base, _ = os.path.splitext(input_file)\n        output_pdf = base + '.pdf'\n\n    os.makedirs(os.path.dirname(output_pdf), exist_ok=True)\n\n    if not _check_dep('pandoc'):\n        output = (json.dumps({\"status\": \"error\", \"message\": \"Missing dependency: pandoc\"}))\n        return\n    if not _check_dep('xelatex'):\n        output = (json.dumps({\"status\": \"error\", \"message\": \"Missing dependency: xelatex (MacTeX required)\"}))\n        return\n\n    try:\n        subprocess.check_call([\n            'pandoc', input_file, '-o', output_pdf,\n            '--pdf-engine=xelatex',\n            '--standalone'\n        ])\n        output = (json.dumps({\"status\": \"success\", \"pdf_file\": output_pdf}))\n    except Exception as e:\n        output = (json.dumps({\"status\": \"error\", \"message\": str(e)}))\n\n_execute_action()"
    }
  }
}
