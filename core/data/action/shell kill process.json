{
  "_id": { "$oid": "68b6bfe83aa5a3e9d9026a19" },
  "name": "shell kill process (cross-platform)",
  "description": "Terminates a process by PID or image name across Windows, macOS, and Linux.",
  "type": "atomic",
  "execution_mode": "sandboxed",
  "platforms": ["windows", "linux", "darwin"],
  "input_schema": {
    "pid": {
      "type": "integer",
      "example": 1234,
      "description": "Process ID to terminate. If provided, takes precedence over image_name."
    },
    "image_name": {
      "type": "string",
      "example": "python",
      "description": "Process image name (e.g., 'python' or 'chrome'). Used when pid is not provided."
    },
    "force": {
      "type": "boolean",
      "example": true,
      "description": "Forceful termination (-9 on Unix, /F on Windows)."
    },
    "tree": {
      "type": "boolean",
      "example": true,
      "description": "Kill the process and its children. Supported on Windows (/T) and Linux/macOS via pkill -P."
    },
    "timeout": {
      "type": "integer",
      "example": 15,
      "description": "Optional timeout in seconds for the kill command."
    }
  },
  "output_schema": {
    "status": {
      "type": "string",
      "example": "success",
      "description": "'success' if the process was terminated, 'error' otherwise."
    },
    "stdout": {
      "type": "string",
      "example": "Process terminated.",
      "description": "Captured standard output from the termination command."
    },
    "stderr": {
      "type": "string",
      "example": "",
      "description": "Captured standard error from the termination command."
    },
    "return_code": {
      "type": "integer",
      "example": 0,
      "description": "Exit code from the termination command. 0 indicates success."
    },
    "message": {
      "type": "string",
      "example": "No target specified.",
      "description": "Optional message for validation or error details."
    }
  },
  "subActions": [],
  "default": false,
  "scope": ["global"],
  "code": "import os, json, subprocess, platform\n\npid = input_data.get('pid')\nimage_name = str(input_data.get('image_name', '')).strip()\nforce = bool(input_data.get('force', False))\ntree = bool(input_data.get('tree', False))\ntimeout_val = input_data.get('timeout')\n\nsystem = platform.system().lower()\n\nif pid is None and not image_name:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': '', 'return_code': -1, 'message': 'Specify either pid or image_name.'}, ensure_ascii=False)\n    raise SystemExit()\n\nif system == 'windows':\n    args = ['taskkill']\n    if pid is not None:\n        args += ['/PID', str(pid)]\n    else:\n        args += ['/IM', image_name]\n    if force:\n        args.append('/F')\n    if tree:\n        args.append('/T')\n\nelse:\n    # macOS / Linux\n    if pid is not None:\n        sig = '-9' if force else '-15'\n        args = ['kill', sig, str(pid)]\n    else:\n        if tree:\n            args = ['pkill', '-f', image_name]\n        else:\n            args = ['pkill'] + (['-9'] if force else []) + ['-f', image_name]\n\ntry:\n    result = subprocess.run(\n        args,\n        capture_output=True,\n        text=True,\n        errors='replace',\n        timeout=float(timeout_val) if timeout_val is not None else None,\n        shell=False\n    )\n    output = json.dumps({\n        'status': 'success' if result.returncode == 0 else 'error',\n        'stdout': result.stdout.strip(),\n        'stderr': result.stderr.strip(),\n        'return_code': result.returncode,\n        'message': ''\n    }, ensure_ascii=False)\nexcept subprocess.TimeoutExpired as e:\n    out = (e.stdout or '').strip()\n    err = (e.stderr or '').strip()\n    msg = f'Timed out after {timeout_val}s.' if timeout_val is not None else 'Timed out.'\n    output = json.dumps({'status': 'error', 'stdout': out, 'stderr': err, 'return_code': -1, 'message': msg}, ensure_ascii=False)\nexcept Exception as e:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': str(e), 'return_code': -1, 'message': str(e)}, ensure_ascii=False)",
  "platform_overrides": {
    "windows": {
      "code": "import os, json, subprocess\n\npid = input_data.get('pid')\nimage_name = str(input_data.get('image_name', '')).strip()\nforce = bool(input_data.get('force', False))\ntree = bool(input_data.get('tree', False))\ntimeout_val = input_data.get('timeout')\n\nif pid is None and not image_name:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': '', 'return_code': -1, 'message': 'Specify either pid or image_name.'}, ensure_ascii=False)\n    raise SystemExit()\n\nargs = ['taskkill']\nif pid is not None:\n    args += ['/PID', str(pid)]\nelse:\n    args += ['/IM', image_name]\nif force:\n    args.append('/F')\nif tree:\n    args.append('/T')\n\ncreationflags = getattr(subprocess, 'CREATE_NO_WINDOW', 0)\n\ntry:\n    result = subprocess.run(args, capture_output=True, text=True, errors='replace', timeout=float(timeout_val) if timeout_val else None, shell=False, creationflags=creationflags)\n    output = json.dumps({\n        'status': 'success' if result.returncode == 0 else 'error',\n        'stdout': result.stdout.strip(),\n        'stderr': result.stderr.strip(),\n        'return_code': result.returncode,\n        'message': ''\n    }, ensure_ascii=False)\nexcept subprocess.TimeoutExpired:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': '', 'return_code': -1, 'message': 'Timed out.'}, ensure_ascii=False)\nexcept Exception as e:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': str(e), 'return_code': -1, 'message': str(e)}, ensure_ascii=False)"
    },
    "linux": {
      "code": "import os, json, subprocess\n\npid = input_data.get('pid')\nimage_name = str(input_data.get('image_name', '')).strip()\nforce = bool(input_data.get('force', False))\ntree = bool(input_data.get('tree', False))\ntimeout_val = input_data.get('timeout')\n\nif pid is None and not image_name:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': '', 'return_code': -1, 'message': 'Specify either pid or image_name.'}, ensure_ascii=False)\n    raise SystemExit()\n\nif pid is not None:\n    sig = '-9' if force else '-15'\n    args = ['kill', sig, str(pid)]\nelse:\n    if tree:\n        args = ['pkill', '-f', image_name]\n    else:\n        args = ['pkill'] + (['-9'] if force else []) + ['-f', image_name]\n\ntry:\n    result = subprocess.run(args, capture_output=True, text=True, errors='replace', timeout=float(timeout_val) if timeout_val else None, shell=False)\n    output = json.dumps({\n        'status': 'success' if result.returncode == 0 else 'error',\n        'stdout': result.stdout.strip(),\n        'stderr': result.stderr.strip(),\n        'return_code': result.returncode,\n        'message': ''\n    }, ensure_ascii=False)\nexcept subprocess.TimeoutExpired:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': '', 'return_code': -1, 'message': 'Timed out.'}, ensure_ascii=False)\nexcept Exception as e:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': str(e), 'return_code': -1, 'message': str(e)}, ensure_ascii=False)"
    },
    "darwin": {
      "code": "import os, json, subprocess\n\npid = input_data.get('pid')\nimage_name = str(input_data.get('image_name', '')).strip()\nforce = bool(input_data.get('force', False))\ntree = bool(input_data.get('tree', False))\ntimeout_val = input_data.get('timeout')\n\nif pid is None and not image_name:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': '', 'return_code': -1, 'message': 'Specify either pid or image_name.'}, ensure_ascii=False)\n    raise SystemExit()\n\nif pid is not None:\n    sig = '-9' if force else '-15'\n    args = ['kill', sig, str(pid)]\nelse:\n    if tree:\n        args = ['pkill', '-f', image_name]\n    else:\n        args = ['pkill'] + (['-9'] if force else []) + ['-f', image_name]\n\ntry:\n    result = subprocess.run(args, capture_output=True, text=True, errors='replace', timeout=float(timeout_val) if timeout_val else None, shell=False)\n    output = json.dumps({\n        'status': 'success' if result.returncode == 0 else 'error',\n        'stdout': result.stdout.strip(),\n        'stderr': result.stderr.strip(),\n        'return_code': result.returncode,\n        'message': ''\n    }, ensure_ascii=False)\nexcept subprocess.TimeoutExpired:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': '', 'return_code': -1, 'message': 'Timed out.'}, ensure_ascii=False)\nexcept Exception as e:\n    output = json.dumps({'status': 'error', 'stdout': '', 'stderr': str(e), 'return_code': -1, 'message': str(e)}, ensure_ascii=False)"
    }
  }
}
