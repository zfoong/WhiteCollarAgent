{
  "_id": { "$oid": "68627c3ac6ce8cf75ea7563a" },
  "name": "google search batch",
  "description": "Performs searches for a list of queries. Uses Google Custom Search API when credentials exist, otherwise falls back to DuckDuckGo (ddgs). Returns a single JSON object containing a single PDF-ready string when pdf=true, with all queries as headings and combined content.",
  "type": "atomic",
  "execution_mode": "internal",
  "mode": "ALL",
  "platforms": ["linux", "windows", "darwin"],
  "input_schema": {
    "queries": {
      "type": "array",
      "items": { "type": "string" },
      "example": ["latest AI news", "best cloud providers 2025"],
      "description": "List of search queries."
    },
    "num_results": {
      "type": "integer",
      "example": 5,
      "description": "Number of results per query."
    },
    "pdf": {
      "type": "boolean",
      "example": false,
      "description": "If true, returns a single JSON object with all queries as headings and combined content in one string."
    }
  },
  "output_schema": {
    "results": {
      "type": "string",
      "description": "When pdf=true, returns a single string with all queries as headings and their combined content. When pdf=false, returns a JSON list of search results per query."
    }
  },
  "code": "import os, json, asyncio, re\nfrom googleapiclient.discovery import build\nfrom ddgs import DDGS\n\nasync def duckduckgo_search(query, num_results=5):\n    dd = DDGS()\n    results = []\n    with dd:\n        hits = list(dd.text(query, max_results=num_results))\n        for hit in hits:\n            url = hit.get('url') or hit.get('href')\n            results.append({\n                'title': hit.get('title') or 'Untitled',\n                'url': url,\n                'content': hit.get('description') or '',\n                'type': 'text'\n            })\n    return results\n\nasync def google_search(query, num_results=5):\n    try:\n        api_key = os.getenv('GOOGLE_API_KEY')\n        cse_id = os.getenv('GOOGLE_CSE_ID')\n        if not api_key or not cse_id: raise Exception('No API key')\n        service = build('customsearch', 'v1', developerKey=api_key)\n        res = service.cse().list(q=query, cx=cse_id, num=num_results).execute()\n        items = res.get('items', [])\n        return [{'title': i.get('title','Untitled'),'url': i.get('link'),'content': i.get('snippet',''),'type':'text'} for i in items]\n    except:\n        return await duckduckgo_search(query, num_results)\n\nasync def batch_search(queries, num_results=5, pdf=False):\n    all_texts = []\n    per_query = []\n    for q in queries:\n        results = await google_search(q, num_results)\n        combined = ' '.join(re.sub(r'\\s+',' ',r.get('content','')).strip() for r in results if r.get('content'))\n        if combined: all_texts.append(f'{q}:\\n{combined}')\n        per_query.append({'query': q, 'search_results': results})\n    return json.dumps({'results':'\\n\\n'.join(all_texts)}) if pdf else json.dumps({'results': per_query})\n\ninput_data = globals().get('input_data', {})\nqueries = input_data.get('queries', [])\nnum_results = int(input_data.get('num_results',5))\npdf = bool(input_data.get('pdf',False))\noutput = asyncio.run(batch_search(queries,num_results,pdf))",
  "default": false,
  "scope": ["global"]
}