{
  "_id": { "$oid": "68627c3ac6ce8cf75ea7543b" },
  "name": "google search",
  "description": "Performs a Google search using Google Custom Search API if credentials exist, otherwise falls back to DuckDuckGo (ddgs). Automatically returns text, image, video, or news results based on the query.",
  "type": "atomic",
  "execution_mode": "internal",
  "code": "import os, json, asyncio, random, re\nfrom aiohttp import ClientSession, ClientTimeout\nfrom ddgs import DDGS\n\nUA_LIST = [\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64)',\n    'Mozilla/5.0 (Macintosh; Intel Mac OS X 13_6)',\n    'Mozilla/5.0 (X11; Ubuntu; Linux x86_64)'\n]\n\ndef _random_ua(): return random.choice(UA_LIST)\n\ndef _normalise_ws(t): return re.sub(r'\\s+', ' ', (t or '')).strip()\n\ndef _strip_links_images(t): return re.sub(r'!\\[.*?\\]\\([^)]*\\)', '', t or '')\n\nasync def _fetch(session, url):\n    try:\n        async with session.get(url, timeout=10) as r:\n            if r.status == 200: return await r.text()\n    except: return ''\n    return ''\n\nasync def duckduckgo_search(query, num_results=5):\n    results = []\n    mode = 'text'\n    dd = DDGS()\n    with dd:\n        hits = list(dd.text(query, max_results=num_results))\n        for hit in hits:\n            url = hit.get('url') or hit.get('href')\n            entry = {\n                'title': _normalise_ws(hit.get('title') or 'Untitled'),\n                'url': url,\n                'content': _strip_links_images(_normalise_ws(hit.get('description') or '')),\n                'type': mode\n            }\n            results.append(entry)\n    return results\n\nasync def google_search(query, num_results=5):\n    try:\n        from googleapiclient.discovery import build\n        api_key = os.getenv('GOOGLE_API_KEY')\n        cse_id = os.getenv('GOOGLE_CSE_ID')\n        if not api_key or not cse_id: raise Exception('No API key')\n        service = build('customsearch', 'v1', developerKey=api_key)\n        res = service.cse().list(q=query, cx=cse_id, num=num_results).execute()\n        items = res.get('items', [])\n        return [{\n            'title': _normalise_ws(i.get('title', 'Untitled')),\n            'url': i.get('link'),\n            'content': _normalise_ws(i.get('snippet', '')),\n            'type': 'text'\n        } for i in items]\n    except:\n        return await duckduckgo_search(query, num_results)\n\ninput_data = globals().get('input_data', {})\nquery = input_data.get('query', '')\nnum_results = int(input_data.get('num_results', 5))\nresults = asyncio.run(google_search(query, num_results))\noutput = json.dumps({'results': results})",
  "input_schema": {
    "query": {
      "type": "string",
      "example": "latest AI developments 2025",
      "description": "The query to search for."
    },
    "num_results": {
      "type": "integer",
      "example": 5,
      "description": "Number of results (1–20)."
    }
  },
  "output_schema": {
    "search_results": {
      "type": "array",
      "description": "List of search‐result objects containing {title, url, content, type}."
    }
  },
  "subActions": [],
  "default": true,
  "scope": ["global"]
}
