name: Article and documentation summary collection
description: Open one or more documentation or article pages (by URL or search query), extract key sections and concise summaries, and consolidate them into a single reference document in the workspace.

goal/outcome:
  - All requested documentation pages or articles are opened and read (from URLs and/or search results for {topic} or {query}).
  - For each source, a short, structured summary is produced that includes:
    - Title (if available),
    - Source URL,
    - 3–10 key bullet points or sections,
    - Optional short notes (e.g., “best practices”, “gotchas”, “API usage pattern”).
  - A single reference document is created in the workspace at {summary_doc_path}, by default in Markdown format (e.g., {topic}_summaries_{date_time}.md).
  - The reference document is organized by source (one section per article) and is easy to skim.
  - The user receives a brief summary message describing:
    - How many sources were processed,
    - Where the reference document is saved,
    - Any sources that could not be fetched or parsed.

inputs_params:
  - Required: One of:
    - A list of URLs to documentation or articles: {url_list}, or
    - One or more search queries to find relevant docs/articles: {query_list}.
  - Optional: Topic label or project name to use in the reference doc title: {topic}.
  - Optional: Output document path and format:
    - Default: {workspace}/{topic}_summaries_{date_time}.md
    - User can override file name or extension (e.g., .txt, .md).
  - Optional: Maximum number of sources to summarize (e.g., top 5 or top 10).
  - Optional: Minimum content quality criteria (e.g., ignore very short pages).
  - Optional: Whether to include short quotes/code snippets or only summaries.
  - Optional: Whether to perform web search when only URLs are given (normally not needed).

context:
  reasoning:
    - Keep the workflow minimal and efficient: confirm which sources to use, fetch them, extract summaries, and write a single reference document.
    - Prefer using "read web page from URL" for each {url} to get a cleaned, markdown-friendly text representation and page title.
    - If only queries are provided, use "google search" (or "google search batch" for multiple {query_list}) once to resolve each query into one or a few URLs, then treat them like normal sources.
    - Avoid complex multi-phase flows; summarization is done directly from the cleaned content without extra intermediate files unless needed.
    - Use "create text file" exactly once (or a small number of times) to write the final reference document to {summary_doc_path}.
    - Use "send_message" to confirm parameters briefly and to deliver the final result.
  deadline: {time_left} left until deadline {deadline}
  definition_of_done(check during final validation step):
    - Every URL or search-derived source that could be fetched has a corresponding section in the reference document (or is explicitly noted as failed).
    - The reference document at {summary_doc_path} exists and contains:
      - A clear top-level title (e.g., “Summaries for {topic} – {date_time}”),
      - For each source:
        - Source title (or placeholder if missing),
        - Source URL,
        - A concise summary (few paragraphs and/or bullet points).
    - The document is readable (no obvious garbled HTML).
    - The user receives a final message with:
      - The number of sources processed,
      - The path {summary_doc_path},
      - Any notable errors or missing sources.
  avoid:
    - Building complex backup or logging systems; a single reference document is enough.
    - Using GUI mode; CLI and HTTP actions are sufficient.
    - Over-summarizing into generic statements; summaries should preserve concrete details (APIs, parameters, steps) in a compact form.
    - Fetching or summarizing far more pages than requested (respect {max_sources} if given).
    - Repeatedly re-fetching the same URL unless needed.

steps:
  name: Confirm sources and output preferences
  description: Make sure the agent knows which pages or queries to use and how the user wants the reference document produced.
  action_instruction: >
    Use "send_message" to restate and confirm:
    - Whether the user is providing:
      - A list of URLs {url_list}, or
      - One or more queries {query_list} to search for articles/documentation.
    - The topic or label {topic} to use in the document title (if any).
    - The maximum number of sources to summarize ({max_sources}, if they want a limit).
    - The desired output file path and format (default {summary_doc_path} as a .md file in the workspace).
    - Whether short quotes or code snippets should be included, or just high-level summaries.
    Ask the user to confirm or adjust the above. If any critical information is missing
    (for example, neither URLs nor queries are provided), use "send_message" with a focused prompt
    such as "Please provide one or more URLs or a search query for the documentation/articles you want summarized."
    Once clarified, send a brief "send_message" summarizing the final agreed inputs (sources and output path).
  validation_instruction: >
    Ensure that:
    - At least one URL in {url_list} or one query in {query_list} is available.
    - A default {summary_doc_path} is decided (or clearly left to a sensible default pattern).
    - {max_sources} is either specified or implicitly treated as "all provided sources".
    Only proceed when sources and output path are unambiguous.

  name: Resolve queries to URLs (if needed)
  description: If the user provided search queries instead of explicit URLs, perform a simple web search to get concrete article/documentation URLs.
  action_instruction: >
    If {url_list} is already provided and no search is needed, skip this step.
    If {query_list} is provided:
      - Use "google search" or "google search batch" with:
        - query or queries: {query_list},
        - num_results set to a small number (e.g., 3–5 per query).
      - From the search_results, select the most relevant URLs per query (e.g., the first result or results that clearly look like docs/articles).
      - Construct a final {resolved_url_list} from all chosen URLs, respecting {max_sources} if set.
      - Optionally send a short "send_message" with a brief list of selected URLs so the user can see what will be summarized.
  validation_instruction: >
    Confirm that:
    - {resolved_url_list} is non-empty after searching.
    - The number of selected URLs does not exceed {max_sources}, if provided.
    - If no usable URLs were found, send a short "send_message" explaining that the search did not return suitable articles/docs and ask the user to provide URLs directly or refine queries. If the user does not provide new input, the task may be "mark task cancel" with a clear reason.

  name: Fetch page content and extract per-source summaries
  description: For each URL, fetch the cleaned page content and extract a short, structured summary suitable for inclusion in the reference document.
  action_instruction: >
    Determine the final list of URLs to process:
      - If {url_list} was provided directly, use that (possibly limited by {max_sources}).
      - If queries were resolved, use {resolved_url_list}.
    For each {url} in the list:
      - Use "read web page from URL" with:
        - url: {url},
        - timeout: a reasonable default (e.g., 10–20 seconds),
        - extract_main: true (if available),
        - include_html: false (unless needed),
        - max_bytes: a reasonable size cap (e.g., 1–2 MB of text).
      - From the returned content:
        - Note the {title} and {final_url} if provided.
        - Use the LLM’s reasoning (no extra tool required) to:
          - Identify the main sections or headings relevant to the user’s goal (e.g., overview, usage, configuration, examples).
          - Extract 3–10 concise bullet points summarizing the main ideas, steps, or API usage.
          - Optionally pick very short quotes or code examples if the user asked for them, keeping them minimal.
      - Accumulate these per-source summaries in the agent’s working context as a structured list:
        - For each source: {title}, {final_url}, {bullet_points}, {notes}.
    If any pages fail to load or parse (e.g., network errors, non-HTML content), record that in a small internal list and mention it later in the final message.
  validation_instruction: >
    After processing all URLs:
    - Check that there is at least one successful summary entry.
    - Ensure that each successful entry has:
      - A title (or a reasonable placeholder like "Untitled {index}"),
      - A URL,
      - A non-empty list of bullet points.
    - If all sources failed, send a "send_message" explaining that none of the pages could be fetched or parsed and suggest that the user check the URLs.
      If no recovery is possible, consider "mark task error" with a short explanation.

  name: Create reference summary document
  description: Consolidate all per-source summaries into a single reference document file in the workspace.
  action_instruction: >
    Construct a Markdown string in memory with the following simple structure:
    - A top-level heading:
      - "# Summary collection for {topic} ({date_time})" or similar, using {topic} if provided.
    - For each summarized source (in order):
      - "## {title}" as a section heading.
      - A line with the source URL: "Source: {final_url}".
      - A short paragraph with a 1–2 sentence overview.
      - A bullet list of key points (3–10 items).
      - Optional subheading "Notes" if there are additional remarks.
    Once the full Markdown content is assembled as a single string:
      - Use "create text file" with:
        - file_path: {summary_doc_path},
        - file_content: the assembled Markdown string.
    This step should create or overwrite the reference document at {summary_doc_path} in one action, rather than appending in many small writes.
  validation_instruction: >
    Confirm from the action output that:
    - Status indicates success.
    - The returned path matches {summary_doc_path}.
    Optionally, if needed, use "shell view" or a quick "create and run python script" to check that the file is non-empty.
    If file creation fails (e.g., invalid path), send a "send_message" explaining the issue and ask the user for a different output path. Retry once if the user provides a new path; otherwise, consider "mark task error" with a short explanation.

  name: Close task and report to user
  description: Summarize what was done, provide the location of the reference document, and mark the task status.
  action_instruction: >
    Use "send_message" to provide a concise final summary including:
    - The number of URLs or sources processed.
    - The number of successful summaries vs. failed or skipped sources.
    - The topic or label {topic}, if used.
    - The path to the reference document {summary_doc_path} in the workspace.
    - Any notable issues (e.g., specific URLs that could not be fetched or looked like non-article content).
    If at least one summary was successfully written and the document was created:
      - Call "mark task completed" with a short message referencing {summary_doc_path} and the count of summarized sources.
    If the user canceled earlier (e.g., did not approve the sources or output path):
      - Call "mark task cancel" with a brief reason.
    If no sources could be summarized or the file could not be created even after reasonable retries:
      - Call "mark task error" with a clear explanation and, if applicable, any partial information that might help the user retry later.
