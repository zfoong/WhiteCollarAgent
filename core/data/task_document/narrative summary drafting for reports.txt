name: Narrative summary drafting for reports
description: Generate concise textual descriptions of trends, patterns, and key points from report data (files or pasted content). Focus on short, clear narratives suitable for inclusion in executive summaries, slide decks, or status updates.

goal/outcome:
  - A short narrative summary (e.g., a few paragraphs or bullet points) that clearly explains the main trends and key insights from the input report data.
  - The summary reflects the specified audience and tone (e.g., executive, technical, neutral) and fits within the desired length (e.g., {max_words} words or {max_paragraphs} paragraphs).
  - The summary mentions important metrics, changes over time, and notable anomalies when present in the source data.
  - The summary is saved to a file in the workspace at {summary_output_path} (e.g., .txt or .md), and optionally returned in the final message.
  - The user receives a brief message describing what was summarized, the style/length used, and where the summary file is stored.

inputs_params:
  - Required: Source report data, one of:
    - File(s) in the workspace: {report_file_paths} (e.g., .txt, .md, .docx, .pdf), or
    - Text pasted directly in chat by the user.
  - Required: Desired summary length (e.g., very short overview, 1–2 paragraphs, or approximate word limit {max_words}).
  - Optional: Target audience (e.g., executive, internal team, technical stakeholders).
  - Optional: Tone and style preferences (e.g., neutral, optimistic, formal, bullet-pointed).
  - Optional: Focus areas or questions (e.g., “revenue trends”, “customer churn”, “operational risks”).
  - Optional: Output file path and format (default: {report_file_base_name}_summary_{date_time}.txt in the workspace).

context:
  reasoning:
    - Keep the process lean: clarify what to summarize and how short it should be, read the relevant report content, then draft a concise narrative in a single pass.
    - Prefer reading the source data in as few actions as possible:
      - Use "read word file" or "read pdf file" for .docx/.pdf inputs.
      - Use "summarize file content" or "batch_summarize_files" only when reports are long or multiple, to reduce token usage.
    - Internally identify key trends (e.g., up/down trends, stable metrics, spikes or drops), time frames, and drivers highlighted in the report.
    - Compress these into short, human-readable narrative paragraphs or bullets that answer “What is happening?”, “How is it changing?”, and “What matters most?”
    - Save the summary to a text or markdown file using "create text file" for easy reuse in other tools or documents.
    - Keep validation simple: check that the summary is short, coherent, and aligned to the stated focus and audience; no need for extra rescans.
  deadline: {time_left} left until deadline {deadline}
  definition_of_done(check during final validation step):
    - The summary:
      - Stays within the requested length or close to it (e.g., within ±20% of {max_words}).
      - Clearly describes the main trends/patterns, key metrics, and any notable anomalies mentioned in the source.
      - Uses the requested tone and audience level (e.g., high-level for executives, slightly more detailed for internal teams).
    - No key sections or time periods explicitly requested by the user are ignored.
    - The summary file exists at {summary_output_path} in the workspace and is readable text.
    - The final message to the user includes:
      - What input was summarized (file names or “pasted text”).
      - The style/length used.
      - The path to the saved summary file.

  avoid:
    - Producing long, multi-page analyses when only short narratives are requested.
    - Copying large chunks of the report verbatim instead of paraphrasing.
    - Introducing new numbers that are not in the source material.
    - Using unnecessarily technical jargon if the target audience is non-technical.
    - Running multiple expensive passes over the same file when one is sufficient.

steps:
  name: Confirm input and summary requirements
  description: Ensure the agent knows what to summarize, how short the summary should be, and who the summary is for.
  action_instruction: >
    Use "send_message" to briefly confirm:
    - Which report data to use:
      - Specific files (e.g., {report_file_paths}), or
      - The last text the user pasted in the chat.
    - Desired summary length (e.g., 1–2 paragraphs, {max_words} words, or "very short" for a few bullet points).
    - Target audience (e.g., executives vs. internal team) and tone (e.g., neutral, formal, upbeat).
    - Any focus areas (e.g., "highlight revenue and cost trends", "focus on customer satisfaction").
    - Preferred output (plain text vs. markdown) and a suggested file name (default {report_file_base_name}_summary_{date_time}.txt).
    If any of these are unclear or missing, use "send_message" with a focused question (e.g., "Do you prefer a very short bullet list or a short paragraph-style summary?").
    Once clarified, restate the final parameters in a short "send_message" so they are recorded in the task context.
  validation_instruction: >
    Confirm that:
    - At least one input source is clearly defined (file path(s) or pasted text).
    - The user has given at least a rough summary length (e.g., short paragraph vs. ~{max_words} words).
    - The tone/audience is either specified or safe to assume as neutral/executive overview.
    If any of these are missing, call "send_message" again and only proceed when the requirements are reasonably clear.

  name: Read and condense report content
  description: Load the relevant report content and reduce it to the essential information needed for a short narrative summary.
  action_instruction: >
    Operate in CLI mode and minimize actions:
    - If the report is provided as file(s):
      - For .txt or .md, you can read them via a single "summarize file content" action for each main file, writing temporary condensed summaries to {temp_summary_file} if needed.
      - For .docx, use "read word file" to extract text; for .pdf, use "read pdf file" to obtain text content.
      - If there are many small files in one folder, "batch_summarize_files" can be used on {input_directory} to get a compact combined summary.
    - If the report content is pasted directly in chat:
      - Treat the chat text as the raw content and skip file-reading actions.
    - Internally (without extra actions), skim the extracted or summarized text to identify:
      - Key metrics or indicators mentioned.
      - Overall trends (e.g., increasing, decreasing, stable).
      - Time periods or segments emphasized in the report.
      - Any standout anomalies, risks, or highlights the report calls out.
  validation_instruction: >
    Ensure that:
    - The selected actions completed successfully (status OK).
    - The extracted or summarized text is non-empty and reasonably complete (not just headings or boilerplate).
    - If the content is unexpectedly short or noisy, send a brief "send_message" to the user indicating this and ask if they still want a summary or additional context.

  name: Draft narrative summary
  description: Based on the condensed content and user preferences, write a short narrative or bullet list that captures the main trends and key points.
  action_instruction: >
    Using the internal LLM reasoning (no extra external tools required):
    - Draft a short summary aligned with:
      - The requested length (e.g., {max_words} words, or {max_paragraphs} paragraphs).
      - The specified audience and tone.
      - The focus areas the user mentioned.
    - Structure the narrative so it is easy to read:
      - For executives: start with 1–2 sentences that capture the overall story (e.g., "Revenue grew steadily while costs remained flat, improving margins.").
      - Optionally break into a few bullet points or short paragraphs covering:
        - Overall trend(s).
        - Key drivers or segments.
        - Notable anomalies or risks.
    - Avoid detailed table-like reporting; keep it interpretive and high-level while still grounded in the source.
    - Once the summary text is ready, save it using "create text file" at {summary_output_path}, using either plain text or lightweight markdown.
  validation_instruction: >
    Quickly self-check the drafted summary:
    - It should be short and focused, not a long rewrite of the entire report.
    - It should mention the main trends, direction of changes (up/down/stable), and any important caveats highlighted in the report.
    - It should match the requested tone (e.g., not overly technical for an executive audience).
    - Confirm that "create text file" returned status OK and that it reports a valid {summary_output_path}.

  name: Overall validate narrative summary
  description: Compare the final summary against the original request and the definition_of_done, ensuring it is usable as-is in a report.
  action_instruction: >
    Using minimal checks:
    - Compare the length of the summary to the requested length (e.g., roughly within ±20% of {max_words} if specified).
    - Ensure that any explicit focus areas from the user (e.g., "customer churn", "operational costs") are at least mentioned or addressed.
    - Verify that there are no contradictions with obvious facts from the report (e.g., not saying "increase" when the source clearly shows a decrease).
    - If a serious mismatch is noticed (wrong focus, tone, or length), adjust the summary once internally and overwrite the same {summary_output_path} with "create text file" again.
    No additional file-reading passes are needed if the summary already meets the basic criteria.

  name: Close task and report to user
  description: Provide the summary (or its location) to the user and mark the task status.
  action_instruction: >
    Use "send_message" to:
    - Briefly restate what was summarized (e.g., "I drafted a short narrative summary of {report_file} focusing on {focus_areas}.").
    - Describe:
      - The length and style of the summary (e.g., "about {max_words} words, executive-level, neutral tone").
      - Where the summary is saved in the workspace: {summary_output_path}.
    - Optionally include the summary text directly in the message if it is short enough and the user is likely to want it inline.
    - Ask the user if they need any quick adjustment (e.g., shorter/longer, more focus on a specific metric) but do not start a new heavy workflow.
    If the summary is satisfactory and the file is correctly created:
      - Call "mark task completed" with a short message summarizing success and pointing to {summary_output_path}.
    If the user cancels before drafting:
      - Call "mark task cancel" with the reason.
    If reading the report or writing the summary file repeatedly fails and a usable summary cannot be produced:
      - Call "mark task error" with a concise explanation of what prevented completion.
