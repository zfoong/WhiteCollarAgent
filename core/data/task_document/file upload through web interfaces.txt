name: File upload through web interfaces
description: Attach and upload files from local folders to specified upload fields in web forms, using the browser-based UI where appropriate. Keep the flow simple: confirm what to upload and where, locate files, perform uploads via the web form, then verify success.

goal/outcome:
  - All specified files from {local_directory_paths} are uploaded to the correct upload fields on the target web form(s) at {upload_url}.
  - Each file is attached to the intended field/section (e.g., profile picture field, document field) according to a clear mapping.
  - Any required authentication or navigation steps to reach the upload form are completed successfully.
  - A simple log is produced listing each uploaded file, the target URL/form, field description, and upload status.
  - The user receives a short summary describing which files were uploaded where, along with any upload errors or skipped files.

inputs_params:
  - Required: Target URL or web application entry point, e.g., {upload_url}.
  - Required: List of file paths or patterns, e.g., {file_paths} or {file_pattern} under {local_root_directory}.
  - Required: Mapping between files (or file groups) and upload fields/sections:
    - Example: {file_path} -> {field_label_or_description}.
  - Optional: Authentication details or instructions:
    - Whether the user is already logged in, or credentials/workflow to log in (without storing passwords in logs).
  - Optional: Navigation hints:
    - Which page menu or button leads to the upload form (e.g., “Settings > Documents > Upload”).
  - Optional: Constraints and preferences:
    - Maximum file size to consider.
    - Maximum number of files to upload in one run.
    - Whether to skip files that appear to be already uploaded or duplicates.
  - Optional: Success indicators:
    - Text, notification, or visual cue that confirms a successful upload, such as {success_message_text} or {success_badge_selector}.

context:
  reasoning:
    - Confirm what files to upload, where they live locally, and exactly which web form fields they should be attached to.
    - Use CLI-oriented actions (“list folder”, “find file by name”) to quickly validate that the requested files exist and are accessible.
    - Use "switch to GUI mode" to interact with the web browser, navigate to {upload_url}, and work directly with the upload fields using the page UI.
    - Keep the GUI interaction straightforward: open URL, authenticate if needed, navigate to the upload form, attach files, submit, then check for a simple success indicator.
    - Optionally use “read web page from URL” to quickly inspect the page structure (titles/text) if needed to confirm you are on the correct page or to detect obvious error pages.
    - For each upload, record minimal but useful information (file path, target field description, upload result) in a text log within the workspace using “create text file”.
    - Avoid unnecessary extra steps such as complex multi-pass scanning or DOM inspection; rely on clear user guidance and simple success checks.
  deadline: {time_left} left until deadline {deadline}
  definition_of_done(check during final validation step):
    - Every file listed in {file_paths} that the user asked to upload has a recorded attempt in the log with a clear status: "uploaded", "skipped", or "error".
    - All “uploaded” entries correspond to visible confirmation on the web interface (success message, presence in a list, or similar).
    - No unintended files were attached (only those within the agreed scope).
    - The user has received a concise message summarizing which files were successfully uploaded, which failed or were skipped, and where the log file is saved.
  avoid:
    - Guessing target fields without any mapping; when unclear, ask the user.
    - Uploading files from locations not explicitly allowed by the user.
    - Repeatedly uploading the same file to the same field unless the user wants to replace/duplicate.
    - Overcomplicated automation strategies (e.g., building full custom HTTP clients) when simple web-form upload is sufficient.

steps:
  name: Confirm upload scope and mapping
  description: Clarify which files should be uploaded, to which web form(s), and to which fields, and ensure authentication/navigation expectations are understood.
  action_instruction: >
    Use "send_message" to restate and confirm:
    - {upload_url} or a brief description of where the upload form lives in the app.
    - The list of files (or patterns) to upload, e.g., {file_paths} or all files under {local_root_directory} matching {file_pattern}.
    - How each file or file group maps to upload fields or sections, e.g., {file_path} -> {field_label_or_description}.
    - Whether the user is already logged into the site or if a login step is required.
    - Any constraints (maximum file size, maximum count) and whether duplicates should be skipped or replaced.
    If any of these are missing or ambiguous (for example, unclear field mapping), use "send_message" with a focused question
    (e.g., "Should {resume.pdf} be attached to the 'Resume' field on {upload_url}?").
    Once clarified, send a short "send_message" summarizing the final agreed input parameters for this task.
  validation_instruction: >
    Confirm that:
    - {upload_url} is provided and looks like a valid web entry point.
    - At least one file or file pattern is specified.
    - There is a clear mapping or rule for which file goes to which field or section.
    - Authentication expectations are clear (logged in already vs. needs login steps).
    Proceed only after the user has explicitly agreed to the summarized scope.

  name: Verify local files to upload
  description: Check that the specified files actually exist in the local filesystem and are within any size constraints before attempting any upload.
  action_instruction: >
    Use CLI-based actions to verify files:
    - If the user specified a directory and pattern (e.g., {local_root_directory}, {file_pattern}):
      - Use "list folder" on {local_root_directory} and, if needed, "find file by name" with {pattern} to discover matching files.
    - If the user specified explicit file paths:
      - Use "list folder" on each parent directory or combine with "find file by name" to confirm existence.
    - Optionally, use "shell exec" with a simple command (e.g., a directory listing) if needed to check file size or count quickly.
    - If any file is missing or fails obvious checks (e.g., size exceeds a user-specified limit), note this and plan to skip it.
    Collect the validated file list internally and, if useful, write a simple text or CSV log of the list to {file_list_log_path} using "create text file".
  validation_instruction: >
    Ensure:
    - At least one file has been validated and is ready for upload.
    - Any missing or invalid files are known and can be reported later.
    If no valid files remain, send a short "send_message" explaining that no files are available to upload under the given criteria and ask whether to adjust paths/patterns or end the task.

  name: Open web form and attach files
  description: Use the browser UI to navigate to the upload form at {upload_url}, then attach each validated file to its mapped upload field.
  action_instruction: >
    - Call "switch to GUI mode" to control the browser and screen.
    - In GUI mode:
      - Open {upload_url} in the default browser (or navigate there if already open).
      - If login is required and instructions were provided, perform the login steps (enter credentials or follow user-specified login flow).
      - Navigate through the site (menus, buttons) to reach the upload form page, using the user’s navigation hints if provided.
      - For each file in the validated list:
        - Identify the corresponding upload field based on {field_label_or_description}.
        - Click the upload/attach button or drop zone, and in the resulting file picker, select the local file at {file_path}.
        - Confirm that the selected filename now appears near the upload field (e.g., displayed name or thumbnail).
      - Optionally take a "screenshot" (using the "screenshot" action) after attaching files but before submitting, saving it to {screenshot_path} for verification if needed.
  validation_instruction: >
    Within GUI mode, visually verify that:
    - Each intended upload field shows the correct filename or file indicator.
    - No unintended or extra files are attached.
    If any attachment appears incorrect (wrong field/file), correct it immediately (remove/clear field and reattach).
    If the form or upload fields are not visible or appear broken, use "send_message" to inform the user and ask for updated instructions or an alternative URL.

  name: Submit upload form and confirm success
  description: Submit the web form to complete the uploads and confirm that each file has been accepted by the web application.
  action_instruction: >
    - Still in GUI mode:
      - Click the appropriate submit/upload button(s) for the form.
      - Wait for the page to respond (progress indicators, refreshes, or messages).
      - Look for a success indicator such as:
        - A confirmation message ({success_message_text}),
        - The file appearing in a list of uploaded documents,
        - A status icon or badge indicating uploaded/complete.
      - If the site clearly lists uploaded files, verify that each {file_name} appears in the list as expected.
    - Optionally, if {upload_url} or a follow-up URL can be safely fetched without authentication issues, use "read web page from URL" to get a text summary and confirm that filenames or confirmation text appear in the content.
    - Build a small in-memory record for each file:
      - {file_path}, {target_field_description}, {result_status}, {notes}.
    - Write this upload result log to {upload_log_path} (e.g., "web_upload_log_{date_time}.csv") in the workspace using "create text file".
  validation_instruction: >
    Confirm that:
    - A visible success indicator is present on the web interface for the form.
    - The number of files reported as uploaded on the page matches the number of "uploaded" entries you plan to write to the log.
    - Any failures or skipped files are captured with a brief reason (e.g., field error, validation error from the site).
    If no clear success indicator exists, treat the result as uncertain, log it as such, and clearly mention this uncertainty in the final message to the user.

  name: Overall validate uploads
  description: Check that the recorded results are consistent with observed behavior on the web form and meet the agreed scope.
  action_instruction: >
    - Use "shell view" or a small "create and run python script" to quickly inspect {upload_log_path}:
      - Count how many rows have status "uploaded", how many have "skipped" or "error".
    - Confirm that:
      - Each validated file from the earlier step appears in the log.
      - No extra or unknown files appear in the log.
    - If the log and observed UI state differ in a major way (e.g., UI shows fewer files than "uploaded" in the log), consider taking a "screenshot" and inform the user that the discrepancy exists.
    If the counts and observations are reasonable and match expectations, treat validation as complete.

  name: Close task and report to user
  description: Summarize which files were uploaded where, mention any errors or skips, and mark the task status.
  action_instruction: >
    Use "send_message" to provide a concise summary:
    - Target upload location(s): {upload_url} and/or page names.
    - Files attempted and their final statuses (e.g., N uploaded, M skipped, K failed).
    - Any notable errors or common reasons for skips (e.g., missing file, site validation error).
    - The path to the upload result log file {upload_log_path}.
    - If taken, the path to any screenshot(s) {screenshot_path} that show the post-upload state.
    If the uploads completed as requested:
      - Call "mark task completed" with a short message summarizing success and pointing to the log.
    If the user canceled or changed their mind mid-way:
      - Call "mark task cancel" with a brief explanation.
    If persistent errors (e.g., site errors, authentication issues) prevented successful uploads:
      - Call "mark task error" with a short description and reference to the log for more detail.
