name: Portal-based data submission workflows
description: Log into one or more web portals, navigate to specific sections or forms, and upload or enter required information. Prefer a simple, efficient GUI-driven flow when the portal is primarily browser-based, and use direct HTTP calls only when the user provides clear API details.

goal/outcome:
  - Successful authentication to the specified portal(s) at {portal_url} using the provided credentials or access method.
  - Required data is entered or uploaded into the correct portal section(s) (e.g., {target_section_path}), following the user’s field and file mapping.
  - Each required submission is completed and visibly confirmed (e.g., confirmation message, submission ID, or status page).
  - A minimal submission log file is created in the workspace at {submission_log_path}, recording at least: portal name, section, timestamp, key parameters (e.g., {submission_id} if available), and status (success/error).
  - The user receives a concise summary of what was submitted, where, and any confirmation identifiers or URLs.

inputs_params:
  - Required: Portal URL(s), e.g., {portal_url}.
  - Required: Authentication details:
    - Username and password, or
    - SSO method description (e.g., “company SSO via {idp_name}”), or
    - API token / session cookie if using direct HTTP.
  - Required: Target section or form description:
    - Human-readable path (e.g., “Reports → Monthly Upload → {year}-{month}”).
    - Or direct URL if the user knows it, e.g., {target_section_url}.
  - Required: Data to submit:
    - Structured field mapping: {field_name} → {field_value_source} (e.g., literal value, or extracted from {data_file_path}).
    - File uploads: local paths in the workspace, e.g., {upload_file_path}.
  - Optional: Submission schedule or repetition (e.g., “only this time”, “do this monthly”) for future automation.
  - Optional: Additional constraints:
    - Whether existing submissions should be updated vs. always creating new ones.
    - Any special validation rules (e.g., “reject if total < 0”, “date must be within {date_range}”).
  - Optional: Preference for interaction type:
    - GUI (via browser controls; default for normal portals).
    - API-based (via “send HTTP requests”) if the user provides endpoint details and auth scheme.

context:
  reasoning:
    - Keep the workflow small and focused: clarify the portal, credentials, target section, and data to submit; then perform a single clean pass to log in, navigate, fill/submit, and record confirmation.
    - Prefer GUI interaction (via “switch to GUI mode”) for typical portals that require JavaScript, complex forms, or SSO flows.
    - Consider “send HTTP requests” only when the user gives explicit API endpoints, auth tokens, and request formats; do not guess API behavior.
    - Prepare data before logging into the portal when possible (e.g., confirm that {upload_file_path} exists or that {data_file_path} can be read).
    - During GUI navigation, rely on the event stream’s screen descriptions to locate menu items, buttons, input fields, and file pickers; avoid extra steps.
    - During submission, map the user’s field mapping ({field_name} → {value}) directly to visible inputs and upload fields; no extra transformation unless explicitly requested.
    - Capture minimal but sufficient evidence of success (confirmation text, IDs, URLs) and write this into {submission_log_path} using “create text file” or a simple append pattern.
    - Keep validation light: confirm login, confirm that the right section is loaded, confirm that a submission confirmation is present, and record key details for the user.
  deadline: {time_left} left until deadline {deadline}
  definition_of_done(check during final validation step):
    - The agent has logged into the portal or used a confirmed API token without errors.
    - Required fields and files for each requested submission have been filled or uploaded in the correct section or endpoint.
    - The portal (or API response) shows clear success feedback (e.g., “Submission successful”, HTTP 2xx, or {submission_id}).
    - A submission log file exists at {submission_log_path} in the workspace, containing:
      - Portal identifier (e.g., {portal_name}),
      - Target section or URL,
      - Timestamp {date_time},
      - Status,
      - Any confirmation messages/IDs.
    - The user has received a summary message describing what was submitted, where, and any confirmations.
  avoid:
    - Guessing credentials, 2FA codes, or security answers; always ask the user when required.
    - Navigating outside the specified portal or section unless needed (e.g., to reach the section via obvious menus).
    - Changing portal settings or data unrelated to the requested submission.
    - Attempting undocumented API calls without user-provided details.
    - Running long, multi-pass workflows; keep to one clear login–navigate–submit–log cycle per task.

steps:
  name: Confirm portal workflow and inputs
  description: Clarify the portal, authentication method, target section, and data to be submitted so that the workflow is unambiguous.
  action_instruction: >
    Use the "send_message" action to summarize what is needed and show the current understanding:
    - {portal_url} or portal name.
    - Auth method: username/password, SSO, or API token.
    - Target section or direct URL (e.g., “Where in the portal should this be submitted?”).
    - For each submission: list required fields (e.g., {field_name}) and their values or source (e.g., literal, from {data_file_path}).
    - Any files to upload with explicit paths in the workspace, such as {upload_file_path}.
    - Whether this is a one-off submission or part of a repeating workflow (for this task, just perform the current run).
    Ask the user to confirm or correct this information. If anything critical is missing or unclear (for example, the target section URL or how to interpret a data field),
    use "send_message" with a focused prompt (e.g., "What is the exact path in the portal where this file should be uploaded?").
    Once the user responds, send a short "send_message" restating the final parameters in a compact checklist.
  validation_instruction: >
    Ensure that:
    - A portal URL {portal_url} and a description of the target section ({target_section_path} or {target_section_url}) are provided.
    - Authentication details are clearly defined (which credentials or token to use).
    - Required fields and upload files are listed with values and valid-looking paths.
    If any of these are missing, use "send_message" again. Proceed only when the user has confirmed the workflow details.

  name: Prepare data and environment
  description: Verify that input files and data are available and choose the interaction mode (GUI vs HTTP) based on user input.
  action_instruction: >
    - If files need to be uploaded:
      - Use "list folder" or, when needed, "find file by name" to ensure that each {upload_file_path} exists in the workspace or under {target_directory}.
      - If a file is missing, use "send_message" to inform the user and ask if they can provide or regenerate it.
    - If structured data is provided in a local file (e.g., {data_file_path}), and you need to extract specific values:
      - Use "read word file", "read pdf file", or "summarize file content" only if necessary to locate a field; otherwise rely on direct user-provided values.
    - Decide interaction mode:
      - If the user expects normal portal usage via browser, or details about API endpoints are not provided, plan to use GUI mode:
        - Call "switch to GUI mode" to enable GUI interaction.
      - If the user gives explicit API endpoint(s), methods, and auth tokens, consider using "send HTTP requests" instead of GUI; keep the flow simple (single request or a small number of requests).
  validation_instruction: >
    Confirm that:
    - All required upload files exist (or the user has been informed if any are missing).
    - Interaction mode is clearly chosen (GUI or HTTP) based on the user’s preference and available details.
    - GUI mode is active if you are going to operate a browser-based workflow.
    If critical prerequisites (like necessary files) cannot be satisfied, explain this via "send_message" and either ask for new input or prepare to "mark task error".

  name: Authenticate to the portal
  description: Log into the portal (or authenticate via API) using the provided credentials or tokens.
  action_instruction: >
    - For GUI-based portal login:
      - In GUI mode, open a browser (according to the agent’s environment) and navigate to {portal_url} using the event stream controls.
      - Locate the username and password fields and enter {username} and {password} as provided.
      - Submit the login form using the visible login button.
      - If SSO is used:
        - Follow the on-screen prompts to select the appropriate IdP and continue until the portal’s main dashboard or landing page is visible.
      - If 2FA or additional verification appears (e.g., code sent via SMS/email), use "send_message" to request the code from the user, then enter it and continue.
    - For API-based authentication:
      - Use "send HTTP requests" to call the specified auth endpoint with the provided credentials or token headers.
      - Store any returned session token or cookie in a variable for subsequent calls within the same action.
  validation_instruction: >
    - For GUI:
      - Confirm that a post-login page or dashboard is visible (e.g., no login error message is present; the URL or page title indicates successful login).
    - For API:
      - Confirm that the HTTP response status is 2xx and that any required session token is present.
    If login fails (incorrect credentials, expired token, or unexpected errors), inform the user with "send_message",
    ask for updated details if appropriate, and retry once if the user provides corrected information. If repeated failures occur, consider "mark task error" with explanation.

  name: Navigate to target submission page
  description: Reach the specific section or form where the data must be entered or uploaded.
  action_instruction: >
    - For GUI:
      - From the portal’s main page, use the menus, navigation bar, or search function as described in the event stream to reach {target_section_path} or {target_section_url}.
      - Follow obvious labels (e.g., "Uploads", "Reports", "New Submission", "Forms", etc.) that align with the user’s description.
      - If the user has provided a direct URL, use the browser’s address bar (via the event stream interactions) to go directly to {target_section_url}.
      - Once on the target form/page, visually confirm (through the UI description) that the expected fields or upload controls are present (e.g., labels that match {field_name} or hints about the type of data).
    - For API:
      - Use "send HTTP requests" with a GET call to the provided submission endpoint (if necessary) to confirm that it is reachable and returns the expected structure or status.
  validation_instruction: >
    - Ensure that the page or endpoint clearly corresponds to the requested submission location (e.g., correct title, headings, or form labels).
    - If it appears that the wrong section is open, use "send_message" to briefly describe what you see and ask the user whether it matches their expectations or if they can provide a more precise path or link.

  name: Enter data, upload files, and submit
  description: Fill the required fields, upload any necessary files, and submit the form or API request.
  action_instruction: >
    - For GUI:
      - For each field specified by the user:
        - Locate the corresponding input element (text box, dropdown, date picker, etc.) using its label or nearby text in the event stream.
        - Enter the provided value {field_value} or select the appropriate option, following the user’s mapping.
      - For file uploads:
        - Activate the upload control (e.g., "Browse" or "Choose file" button).
        - Use the file picker as described in the event stream to select {upload_file_path} from the workspace.
      - Double-check obvious dependencies (e.g., required fields are not left blank).
      - Click the submit button once, and wait for the page to show a confirmation or next step.
    - For API:
      - Build the request body according to the user’s specification (e.g., JSON payload with the fields to submit).
      - If files must be uploaded, use "send HTTP requests" with multipart/form-data if supported and clearly described by the user.
      - Send the request and capture the response.
  validation_instruction: >
    - For GUI:
      - Confirm that the page now displays a success message, status indicator, or other confirmation (e.g., "Your submission has been received", or showing a {submission_id}).
    - For API:
      - Confirm that the HTTP status is 2xx and that the response body does not contain an error message.
    - Extract any useful confirmation identifier or reference number and note it for logging (e.g., {submission_id}, {confirmation_text}, {confirmation_url}).

  name: Record submission details and validate workflow
  description: Create or update a simple log of submissions and check the overall workflow against the definition_of_done.
  action_instruction: >
    - Use "get current time" to obtain {date_time} for the log entry.
    - Use "create text file" (for a new log) or "replace file str" / a small "create and run python script" (for appending) to maintain a log at {submission_log_path} that includes, for each submission:
      - {portal_name} or {portal_url},
      - {target_section_path} or {target_section_url},
      - {date_time},
      - {submission_status} (e.g., success/error),
      - Any {submission_id} or confirmation snippet.
    - Compare what was achieved against the goals:
      - Logged in successfully.
      - Reached the correct section.
      - Entered/uploaded the specified data.
      - Received confirmation from the portal or API.
    - If any major step failed (e.g., could not reach section, submission rejected), send a "send_message" explaining the failure and whether anything was partially submitted, then consider if a retry or correction is reasonable within this task.
  # This step uses the global definition_of_done above; no separate validation_instruction is needed.

  name: Close task and report to user
  description: Provide a concise summary of the portal workflow outcome and mark the task status.
  action_instruction: >
    Use "send_message" to give a brief summary that includes:
    - The portal name and {portal_url}.
    - The section where data was submitted (e.g., {target_section_path}).
    - A list or short description of what was submitted (key fields and file names like {upload_file_name}).
    - Whether the submission appears successful, and any confirmation identifier or URL.
    - The location of the submission log file in the workspace ({submission_log_path}).
    If the workflow completed satisfactorily, call "mark task completed" with a short message summarizing success and referencing the log.
    If the user asked to cancel before submission (e.g., upon seeing the target page), call "mark task cancel" with the reason.
    If it was not possible to log in, reach the section, or complete the submission as requested, call "mark task error" with a concise explanation and mention any partial log entries that may help the user troubleshoot.
